import os
from groq import Groq

# Add this to your CONFIG
GROQ_API_KEY = "YOUR_API_KEY_HERE" # Your Key Here
groq_client = Groq(api_key=GROQ_API_KEY)

def cloud_final_polish(text_chunk_batch):
    """
    Sends a large batch of text to Groq for a high-quality final translation.
    Trigger this every 7-10 chunks.
    """
    try:
        completion = groq_client.chat.completions.create(
            model="llama-3.3-70b-versatile",
            messages=[
                {
                    "role": "system",
                    "content": "You are an expert editor. Rewrite the following transcription into professional, flowing English prose. Fix any remaining phonetic errors or fragmentation."
                },
                {
                    "role": "user",
                    "content": text_chunk_batch
                }
            ],
            temperature=0.3,
            max_tokens=1024,
            top_p=1,
            stream=False,
            stop=None,
        )
        return completion.choices[0].message.content
    except Exception as e:
        print(f"[CLOUD] Error: {e}")
        return None
    
def main():
    text_chunk_patch = """أشهد أن لا إله إلا الله

مدى الرسول الله  حياة الصلاة

الحمد لله نحمده ونستعينه ونستغفره  ونعوذ بالله من شرور أنفسنا وسيئات أعمالها

من يهده الله فلا مبل له  ومن يضلل فلا هادي له  وأشهد أن لا إله إلا الله  وحده لا شريك له  وأشهد أن محمداً عبده ورسوله  يَا أَيُّهَا الَّذِينَ آمَنُوا اتَّقُوا اللَّهَ حَقَّ تُقْوَاتِهِ وَلَا تَمُوتُنَّ إِلَّا وَأَنْتُمْ مُسْلِمُونَ  يَا أَيُّهَا الَّذِينَ آمَنُوا اتَّقُوا اللَّهَ وَقُولُوا قَوْلًا سَدِيدًا يُصْلِحْ لَكُمُ أَعْمَالَكُمْ وَيَغْفِرْ لَكُمْ ذُنُوبَكُمْ وَمَنْ يُطِعِ اللَّهَ وَرَسُولَهُ فَقَدْ فَازَ فَوْزًا عَظِمًا  يَا أَيُّهَا النَّاسُ اتَّقُوا رَبَّكُمُ الَّذِي خَلَقَكُمْ مِن نَفْسٍ وَاحِدَةً وَخَلَقَ مِنْهَا زَوْجَهَا وَبَجْتَ مِنْهُمَا إِجَالًا مِنْهُمْ

كَثِيرًا وَنِسَاءً  وَاتَّقُوا اللَّهَ الَّذِي تَسْسَأَلُونَ بِهِ وَالأَرْحَامِ  إِنَّ اللَّهَ كَانَ عَلَيْكُمْ رَقِيبًا  أما بعض فإن خير الحديث  كلام الله وكتابه سبحانه وتعالى  وخير الهدي  هدي محمد صلى الله عليه وسلم  وشر الأمور محدثاتها  وكل مُحدَثةٍ مِدْعَة  وكل بِدَعةٍ ضلالة  وكل ضلالةٍ في النار  أيها الناس  إن جميع القرائم  تدلُّ على أن العالم مُقبِلُ اليوم على تغيُّراتٍ عظيمةٍ جدًّا  لا مثيل لها فيما سبق  فلا يُمكنُنا  أنا وأنت  اليوم النبضة

وفاقِلينَ عما يُرادُ بنا  تافِهينَ في انشِغالاتِنا  واهتِباماتِنا  لا بُدَّ أن نستيقِظَ من غفلتِنا  وأن نُعيدَ النظرَ في جدولِ أولوياتِنا  ولكن يا إخوة  السؤال هو كيف وبما  والجوابُ يُجيبُ عنه الله عزَّ وجل  فأنت اليوم بما أنك في صلاة الجمعة  قد علمت بفضل الله ومنته  أنه بسم الله الرحمن الرحيم  الحمد لله رب العالمين  الرحمن الرحيم  ملك يوم الدين  فهو أرشدك بمحض تفضل منه ورحمه  بعد ان اثنيت عليه وحمدته

وشهدت له بالزلال الذي يليق به  أنعم عليك فأرشدك أن تقول  إياك نعبد  إياك نعبد  تدرج نفسك في ذمنة العابدين طبعا  ثم بين لك أن هذه العبادة  لا تكون إلا بعونه فعلمك أن تستعين به هو وحده  فقلت بعد إذ علمك  وإياك نستعينك  فبعد أن انفذلت بجود الله وكرمه عليك  زادك على المنة منه  وعلى العضاء عضاء  بأن ملحك فهو المناح  وأن أكرمك فهو الكريم  فاطلب ما شئت  ولأنه يعلم مبلغ الزهل منك ومني  إلا أنه يعلمك ربك الذي خلق  خلق الإنسان من علق  ههههه

يبين لك ربك الأكرم الذي علم بالقلم علم الإنسان ما لم يعلم  الذي علم أن هذا الكنز وهو الذي جاء إن شاء الله وآدم  أن هذا الكنز حريم أن يضيع بين يديك  الله سبحانه وتعالى الآن أعطاك دعاء دعوة مستجابة بعد أن حمدته وذلك في كل صدق  ثم علم أنك لا تحسن الدعاء  فعلمك وقال لك قل اهدنا الصراط المستقيم  فما بعد الهداية من شقاء  وما بعد الضلال من سعادة  صراطا أيا كان كلا  بل صراط أولئك الذين ولوا مرضيا عنهم  صراطا الذين أنعمت عليهم يا رب  غير المفضوب عليهم ولا الضالين  ثم أمنت فجاءك العطاء  من الذي امرك ان تسأل يجيبك وان تطلب ان يعطيك"""


    print(f"this is groq output: {cloud_final_polish(text_chunk_patch)}")

if __name__ == "__main__":
    main()
